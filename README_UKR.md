# ü§ñ AntiBullyBot ‚Äì –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è –±–æ—Ä–æ—Ç—å–±–∏ –∑ –±—É–ª—ñ–Ω–≥–æ–º —É —à–∫–æ–ª–∞—Ö

**AntiBullyBot** ‚Äì —Ü–µ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Ç–æ–≥–æ, —â–æ–± —à–∫–æ–ª—è—Ä—ñ –º–æ–≥–ª–∏ –±–µ–∑–ø–µ—á–Ω–æ —Ç–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ –ø—Ä–æ –≤–∏–ø–∞–¥–∫–∏ –±—É–ª—ñ–Ω–≥—É, –∞ —Ç–∞–∫–æ–∂ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —à–≤–∏–¥–∫—É —Ç–∞ –∫–æ—Ä–∏—Å–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É.

–ë–æ—Ç –¥–æ–ø–æ–º–∞–≥–∞—î —É—á–Ω—è–º, –≤—á–∏—Ç–µ–ª—è–º —Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó —Å–≤–æ—î—á–∞—Å–Ω–æ —Ä–µ–∞–≥—É–≤–∞—Ç–∏ –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É –±—É–ª—ñ–Ω–≥—É —Ç–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∑–¥–æ—Ä–æ–≤—É –π –±–µ–∑–ø–µ—á–Ω—É –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –≤ –∫–ª–∞—Å–∞—Ö.

## üéØ –Ø–∫—ñ –∑–∞–¥–∞—á—ñ –≤–∏—Ä—ñ—à—É—î AntiBullyBot?

* üõ°Ô∏è **–ë–µ–∑–ø–µ—á–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –±—É–ª—ñ–Ω–≥**: –î—ñ—Ç–∏ –º–æ–∂—É—Ç—å –∞–Ω–æ–Ω—ñ–º–Ω–æ —á–∏ –≤—ñ–¥–∫—Ä–∏—Ç–æ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ –ø—Ä–æ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∏.
* üí¨ **–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó —Ç–∞ –¥–æ–ø–æ–º–æ–≥–∞**: –ë–æ—Ç –Ω–∞–¥–∞—î –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø–æ—Ä–∞–¥–∏ —â–æ–¥–æ –¥—ñ–π —É —Å–∏—Ç—É–∞—Ü—ñ—ó –±—É–ª—ñ–Ω–≥—É —è–∫ –∂–µ—Ä—Ç–≤–∞–º, —Ç–∞–∫ —ñ —Å–≤—ñ–¥–∫–∞–º.
* üìö **–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞**: –û—Å–≤—ñ—Ç–∞ —Ç–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –æ–±—ñ–∑–Ω–∞–Ω–æ—Å—Ç—ñ —Å–µ—Ä–µ–¥ —É—á–Ω—ñ–≤ –ø—Ä–æ –±—É–ª—ñ–Ω–≥ —ñ –º–µ—Ç–æ–¥–∏ –π–æ–≥–æ –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è.

## üìê –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### üìÇ –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:

* `bot.js` ‚Äì –≥–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª, —â–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î —Ç–∞ –∑–∞–ø—É—Å–∫–∞—î —á–∞—Ç-–±–æ—Ç.
* `controller` ‚Äì –ª–æ–≥—ñ–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –±–æ—Ç–∞ –Ω–∞ –¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:

  * `controller/botMiddleware.js` ‚Äì middleware –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—ñ–≤.
  * `controller/controller.js` ‚Äì –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞.
* `conversations/*` ‚Äì —Å—Ü–µ–Ω–∞—Ä—ñ—ó —Ä–æ–∑–º–æ–≤ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≥—Ä—É–ø –∞—É–¥–∏—Ç–æ—Ä—ñ—ó.
* `db/*` ‚Äì —Ñ—É–Ω–∫—Ü—ñ—ó —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö.
* `utils/*` ‚Äì –¥–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è.

### üñ•Ô∏è –¢–µ—Ö–Ω—ñ—á–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ

* **Node.js** –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏
* **Express.js** —è–∫ –≤–µ–±—Å–µ—Ä–≤–µ—Ä
* **GrammY** –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Telegram Bot API
* **MySQL** (–∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
* **PM2** ‚Äì –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –¥–æ–¥–∞—Ç–∫—É

### üîå –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏

**Telegram Bot API** –ø—ñ–¥—Ç—Ä–∏–º—É—î 2 —Ä–µ–∂–∏–º–∏ —Ä–æ–±–æ—Ç–∏:

* üîÑ **Long-pooling**: –±–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –∑–∞–ø–∏—Ç–∏ –Ω–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å (–¥–æ 30 —Å–µ–∫—É–Ω–¥).
* üåê **Webhook**: –∑–∞–ø—É—Å–∫–∞—î –≤–µ–±—Å–µ—Ä–≤–µ—Ä (`express.js`) –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å.

**–ë–∞–∑–∞ –î–∞–Ω–∏—Ö:**

* `db/config.js` ‚Äì —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—É–ª—É –∑'—î–¥–Ω–∞–Ω—å.
* `db/stateManager.js` ‚Äì –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è/—á–∏—Ç–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* `db/create_tables.sql` ‚Äì —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å.

‚úÖ –ó–∞–ø–∏—Ç–∏ –¥–æ –ë–î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ, –Ω–µ –±–ª–æ–∫—É—é—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—é –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.

### üîê –ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

–î–æ–¥–∞—Ç–æ–∫ –º–∞—î **stateless** –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É (–Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞–Ω –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏). –í—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–∞ —ñ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Ç–∏.

–£ –ë–î –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è:

* –°—Ç–∞—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (`bot_users`), –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –∑–≤–µ—Ä–Ω–µ–Ω—å ("–∑—Ä–æ–±–∏–≤/–∑—Ä–æ–±–∏–ª–∞"). –ó–±—ñ–π —É –ë–î –Ω–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –∑–±–æ—é –≤ —Ä–æ–±–æ—Ç—ñ —á–∞—Ç-–±–æ—Ç–∞.
* –Ü—Å—Ç–æ—Ä—ñ—è –≤–∑–∞—î–º–æ–¥—ñ—ó (`user-states`) –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –º–µ—Ç—Ä–∏–∫.

‚ùó –£ –ë–î **–ù–ï –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è** —á—É—Ç–ª–∏–≤—ñ –æ—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ **Telegram ID** ‚Äì —Ü–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Ü–∏—Ñ—Ä–æ–≤–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä, —è–∫–∏–π –Ω–µ —Ä–æ–∑–∫—Ä–∏–≤–∞—î –æ—Å–æ–±–∏—Å—Ç—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é (—é–∑–µ—Ä–Ω–µ–π–º, —ñ–º'—è, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É —Ç–æ—â–æ). –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è —Ö–µ—à—É–≤–∞—Ç–∏ ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º.

### üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞ –¥–æ–¥–∞—Ç–∫—É

–ß—É—Ç–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è, —â–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `.env.<mode>` —Ñ–∞–π–ª–∞—Ö:

```dotenv
# –í–µ–±—Å–µ—Ä–≤–µ—Ä
PORT=
WEBHOOK_DOMAIN=
SECRET_TOKEN=

# –ë–æ—Ç
BOT_TOKEN=

# –ë–î
DB_HOST=
DB_USER=
DB_NAME=
DB_PASSWORD=
```

## üöÄ –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–í —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—å:

* Node.js v.20.13 (LTS), v.16 (LTS)
  ‚ö†Ô∏è **–í–ê–ñ–õ–ò–í–û:** Node.js v.21 –º–æ–∂–µ –º–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.
* MySQL v.5.7.34

### üåç –ú–µ—Ä–µ–∂–µ–≤—ñ –≤–∏–º–æ–≥–∏

* –î–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–≤–µ—Ä–∞.
* –î–ª—è –∑–∞–ø—É—Å–∫—É –≤ —Ä–µ–∂–∏–º—ñ WebHook **–Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π** –¥—ñ—é—á–∏–π SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç.

## üõ†Ô∏è –ó–∞–ø—É—Å–∫

### üåê Webhook mode

```bash
NODE_ENV=prod BOT_MODE=webhook node bot.js
```

### üîÑ Long pooling mode

```bash
NODE_ENV=prod node bot.js
```

–î–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **PM2**:

### üñ•Ô∏è PM2 (dev webhook mode)

```bash
NODE_ENV=dev BOT_MODE=webhook pm2 start bot.js --name "bot_webhook_dev" --log <logFileName>
```
